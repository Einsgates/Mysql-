mysql查询练习

一、建表

create database selectTest;
use selectTest;

-- 学生表Student:
-- 学号
-- 姓名
-- 性别
-- 出生年月日
-- 所在班级
create table student(
	sno varchar(20) primary key,
	sname varchar(20) not null,
	ssex varchar(10) not null,
	sbirthday datetime,
	class varchar(20)
);

-- 教师表teacher:
-- 教师编号
-- 教师名字
-- 教师性别
-- 出生年月日
-- 职称
-- 所在部门
create table teacher(
	tno varchar(20) primary key,
	tname varchar(20) not null,
	tsxe varchar (10) not null,
	tbirthday datetime,
	prof varchar(20) not null,
	depart varchar(20) not null
);

-- 课程表Course:
-- 课程号
-- 课程名称
-- 教师编号
create table course(
	cno varchar(20) primary key,
	cname varchar(20) not null,
	tno varchar(20) not null,
	foreign key(tno) references teacher (tno)
);


-- 成绩表score:
-- 学号
-- 课程号
-- 成绩
create table score(
	sno varchar(20) not null,
	cno varchar(20) not null,
	scores decimal,
	foreign key(sno) references student(sno),
	foreign key(cno) references course(cno),
	primary key(sno, cno)
);
show tables;
+----------------------+
| Tables_in_selecttest |
+----------------------+
| course               |
| score                |
| student              |
| teacher              |
+----------------------+
4 rows in set (0.01 sec)

-- 往数据表中添加数据
#添加学生信息:
insert into student values('101','曾华','男','1977-09-01','95033');
insert into student values('102','匡明','男','1975-10-02','95031');
insert into student values('103','王丽','女','1976-01-23','95033');
insert into student values('104','李军','男','1976-02-20','95033');
insert into student values('105','王芳','女','1975-02-10','95031');
insert into student values('106','陆君','男','1974-06-03','95031');
insert into student values('107','王尼玛','男','1976-02-20','95031');
insert into student values('108','张全蛋','男','1975-02-10','95031');
insert into student values('109','赵铁柱','男','1974-06-03','95031');
select * from student;
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 101 | 曾华      | 男   | 1977-09-01 00:00:00 | 95033 |
| 102 | 匡明      | 男   | 1975-10-02 00:00:00 | 95031 |
| 103 | 王丽      | 女   | 1976-01-23 00:00:00 | 95033 |
| 104 | 李军      | 男   | 1976-02-20 00:00:00 | 95033 |
| 105 | 王芳      | 女   | 1975-02-10 00:00:00 | 95031 |
| 106 | 陆君      | 男   | 1974-06-03 00:00:00 | 95031 |
| 107 | 王尼玛    | 男   | 1976-02-20 00:00:00 | 95031 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
| 109 | 赵铁柱    | 男   | 1974-06-03 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
9 rows in set (0.00 sec)

#添加教师表
insert into teacher values('804','李诚','男','1958-12-02','副教授','计算机系');
insert into teacher values('856','张旭','男','1969-03-12','讲师','电子工程系');
insert into teacher values('825','王萍','女','1972-05-05','助教','计算机系');
insert into teacher values('831','刘冰','女','1977-08-14','助教','电子工程系');
select * from teacher;
mysql> select * from teacher;
+-----+--------+------+---------------------+-----------+-----------------+
| tno | tname  | tsxe | tbirthday           | prof      | depart          |
+-----+--------+------+---------------------+-----------+-----------------+
| 804 | 李诚   | 男   | 1958-12-02 00:00:00 | 副教授    | 计算机系        |
| 825 | 王萍   | 女   | 1972-05-05 00:00:00 | 助教      | 计算机系        |
| 831 | 刘冰   | 女   | 1977-08-14 00:00:00 | 助教      | 电子工程系      |
| 856 | 张旭   | 男   | 1969-03-12 00:00:00 | 讲师      | 电子工程系      |
+-----+--------+------+---------------------+-----------+-----------------+
4 rows in set (0.00 sec)

#添加课程表
insert into course values('3-105','计算机导论','825');
insert into course values('3-245','操作系统','804');
insert into course values('6-166','数字电路','856');
insert into course values('9-888','高等数学','831');
select * from course;
+-------+-----------------+-----+
| cno   | cname           | tno |
+-------+-----------------+-----+
| 3-105 | 计算机导论      | 825 |
| 3-245 | 操作系统        | 804 |
| 6-166 | 数字电路        | 856 |
| 9-888 | 高等数学        | 831 |
+-------+-----------------+-----+
4 rows in set (0.00 sec)

#添加成绩表
insert into score values('103','3-105','92');
insert into score values('103','3-245','86');
insert into score values('103','6-166','85');
insert into score values('105','3-105','88');
insert into score values('105','3-245','75');
insert into score values('105','6-166','79');
insert into score values('109','3-105','76');
insert into score values('109','3-245','68');
insert into score values('109','6-166','81');
select * from score;
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 3-105 |     92 |
| 103 | 3-245 |     86 |
| 103 | 6-166 |     85 |
| 105 | 3-105 |     88 |
| 105 | 3-245 |     75 |
| 105 | 6-166 |     79 |
| 109 | 3-105 |     76 |
| 109 | 3-245 |     68 |
| 109 | 6-166 |     81 |
+-----+-------+--------+
9 rows in set (0.00 sec)



二、查询练习

-- 1.查询student表的所有记录
select * from student;
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 101 | 曾华      | 男   | 1977-09-01 00:00:00 | 95033 |
| 102 | 匡明      | 男   | 1975-10-02 00:00:00 | 95031 |
| 103 | 王丽      | 女   | 1976-01-23 00:00:00 | 95033 |
| 104 | 李军      | 男   | 1976-02-20 00:00:00 | 95033 |
| 105 | 王芳      | 女   | 1975-02-10 00:00:00 | 95031 |
| 106 | 陆君      | 男   | 1974-06-03 00:00:00 | 95031 |
| 107 | 王尼玛    | 男   | 1976-02-20 00:00:00 | 95031 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
| 109 | 赵铁柱    | 男   | 1974-06-03 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
9 rows in set (0.01 sec)


-- 2.查询student表中的所有记录的sname, ssex和class列
select sname, ssex, class from student;
+-----------+------+-------+
| sname     | ssex | class |
+-----------+------+-------+
| 曾华      | 男   | 95033 |
| 匡明      | 男   | 95031 |
| 王丽      | 女   | 95033 |
| 李军      | 男   | 95033 |
| 王芳      | 女   | 95031 |
| 陆君      | 男   | 95031 |
| 王尼玛    | 男   | 95031 |
| 张全蛋    | 男   | 95031 |
| 赵铁柱    | 男   | 95031 |
+-----------+------+-------+
9 rows in set (0.00 sec)


-- 3.查询教师所有的单位即不重复的depart列
-- distinct排除重复
select distinct depart from teacher;
+-----------------+
| depart          |
+-----------------+
| 计算机系        |
| 电子工程系      |
+-----------------+
2 rows in set (0.00 sec)


-- 4.查询score表中成绩在60到80之间的所有记录
-- 查询区间 between ... and ...
select * from score where scores <= 80 and scores >= 60;
或者:
select * from score where scores between 60 and 80;
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 105 | 3-245 |     75 |
| 105 | 6-166 |     79 |
| 109 | 3-105 |     76 |
| 109 | 3-245 |     68 |
+-----+-------+--------+
4 rows in set (0.00 sec)


-- 5.查询score表中成绩为85，86或88的记录
-- 表示或者关系的查询 in
select * from score where scores in(85, 86, 88);
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 3-245 |     86 |
| 103 | 6-166 |     85 |
| 105 | 3-105 |     88 |
+-----+-------+--------+
3 rows in set (0.01 sec)


-- 6.查询student表中"95031"班或者性别为"女"的同学记录
-- or表示或者
select * from student where class = '95031' or ssex = '女';
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 102 | 匡明      | 男   | 1975-10-02 00:00:00 | 95031 |
| 103 | 王丽      | 女   | 1976-01-23 00:00:00 | 95033 |
| 105 | 王芳      | 女   | 1975-02-10 00:00:00 | 95031 |
| 106 | 陆君      | 男   | 1974-06-03 00:00:00 | 95031 |
| 107 | 王尼玛    | 男   | 1976-02-20 00:00:00 | 95031 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
| 109 | 赵铁柱    | 男   | 1974-06-03 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
7 rows in set (0.00 sec)


-- 7.以class降序查询student表的所有记录
-- 升序asc、降序desc
select * from student order by class desc;
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 101 | 曾华      | 男   | 1977-09-01 00:00:00 | 95033 |
| 103 | 王丽      | 女   | 1976-01-23 00:00:00 | 95033 |
| 104 | 李军      | 男   | 1976-02-20 00:00:00 | 95033 |
| 102 | 匡明      | 男   | 1975-10-02 00:00:00 | 95031 |
| 105 | 王芳      | 女   | 1975-02-10 00:00:00 | 95031 |
| 106 | 陆君      | 男   | 1974-06-03 00:00:00 | 95031 |
| 107 | 王尼玛    | 男   | 1976-02-20 00:00:00 | 95031 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
| 109 | 赵铁柱    | 男   | 1974-06-03 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
9 rows in set (0.00 sec)


-- 8.以cno升序、scores降序查询score表的所有记录
select * from score order by cno, scores desc;
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 3-105 |     92 |
| 105 | 3-105 |     88 |
| 109 | 3-105 |     76 |
| 103 | 3-245 |     86 |
| 105 | 3-245 |     75 |
| 109 | 3-245 |     68 |
| 103 | 6-166 |     85 |
| 109 | 6-166 |     81 |
| 105 | 6-166 |     79 |
+-----+-------+--------+
9 rows in set (0.00 sec)


-- 9.查询"95031"班的学生人数
-- 统计count
select count(*) from student where class = '95031';
+----------+
| count(*) |
+----------+
|        6 |
+----------+
1 row in set (0.01 sec)


-- 10.查询score表中的最高分的学生学号和课程号(子查询或排序)
select sno, cno from score where scores = (select max(scores) from score);
+-----+-------+
| sno | cno   |
+-----+-------+
| 103 | 3-105 |
+-----+-------+
1 row in set (0.01 sec)
-- 1 找到最高分
select max(scores) from score;
-- 2 找到最高分的 sno 和 cno
select sno, cno from score where scores = (select max(scores) from score);

-- 排序做法: 
select sno, cno, scores from score order by scores desc limit 0,1;
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 3-105 |     92 |
+-----+-------+--------+
1 row in set (0.00 sec)
#limit相当于从0开始传一条
-- 若从1开始传两条:
select * from score order by scores desc limit 1,2;
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 105 | 3-105 |     88 |
| 103 | 3-245 |     86 |
+-----+-------+--------+
2 rows in set (0.00 sec)


-- 11.查询每门课的平均成绩
查看有哪些课:
select * from course;
+-------+-----------------+-----+
| cno   | cname           | tno |
+-------+-----------------+-----+
| 3-105 | 计算机导论      | 825 |
| 3-245 | 操作系统        | 804 |
| 6-166 | 数字电路        | 856 |
| 9-888 | 高等数学        | 831 |
+-------+-----------------+-----+
4 rows in set (0.00 sec)
分别求出这四门课程的平均成绩，使用 avg()方法
select avg(scores) from score where cno = '3-105';
+-------------+
| avg(scores) |
+-------------+
|     85.3333 |
+-------------+
1 row in set (0.00 sec)
select avg(scores) from score where cno = '3-245';
+-------------+
| avg(scores) |
+-------------+
|     76.3333 |
+-------------+
1 row in set (0.00 sec)
select avg(scores) from score where cno = '6-166';
+-------------+
| avg(scores) |
+-------------+
|     81.6667 |
+-------------+
1 row in set (0.00 sec)
select avg(scores) from score where cno = '9-888';
+-------------+
| avg(scores) |
+-------------+
|        NULL |
+-------------+
或者直接全部选出来:
select cno, avg(scores) from score group by cno;
+-------+-------------+
| cno   | avg(scores) |
+-------+-------------+
| 3-105 |     85.3333 |
| 3-245 |     76.3333 |
| 6-166 |     81.6667 |
+-------+-------------+
3 rows in set (0.00 sec)
-- group by 分组


-- 12.查询score表中至少有2名学生选修的并以3开头的课程的平均分数
-- group by 使用的是 having, 模糊查询使用的是like 'x%'
select cno, avg(scores), count(*) from score group by cno
having count(cno) >= 2 and cno like '3%';
+-------+-------------+----------+
| cno   | avg(scores) | count(*) |
+-------+-------------+----------+
| 3-105 |     85.3333 |        3 |
| 3-245 |     76.3333 |        3 |
+-------+-------------+----------+
2 rows in set (0.00 sec)

-- 13.查询分数大于70小于90的sno列
select sno, scores from score where scores >= 70 and scores <= 90;
-- 或者:
select sno, scores from score where scores between 70 and 90;
+-----+--------+
| sno | scores |
+-----+--------+
| 103 |     86 |
| 103 |     85 |
| 105 |     88 |
| 105 |     75 |
| 105 |     79 |
| 109 |     76 |
| 109 |     81 |
+-----+--------+
7 rows in set (0.00 sec)


-- 14.查询所有学生的 sname, cno 和scores 列
select sno, sname from student;
+-----+-----------+
| sno | sname     |
+-----+-----------+
| 101 | 曾华      |
| 102 | 匡明      |
| 103 | 王丽      |
| 104 | 李军      |
| 105 | 王芳      |
| 106 | 陆君      |
| 107 | 王尼玛    |
| 108 | 张全蛋    |
| 109 | 赵铁柱    |
+-----+-----------+
9 rows in set (0.00 sec)

select sno, cno, scores from score;
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 3-105 |     92 |
| 103 | 3-245 |     86 |
| 103 | 6-166 |     85 |
| 105 | 3-105 |     88 |
| 105 | 3-245 |     75 |
| 105 | 6-166 |     79 |
| 109 | 3-105 |     76 |
| 109 | 3-245 |     68 |
| 109 | 6-166 |     81 |
+-----+-------+--------+
9 rows in set (0.00 sec)

select sname, cno, scores from student, score
where student.sno = score.sno;

+-----------+-------+--------+
| sname     | cno   | scores |
+-----------+-------+--------+
| 王丽      | 3-105 |     92 |
| 王丽      | 3-245 |     86 |
| 王丽      | 6-166 |     85 |
| 王芳      | 3-105 |     88 |
| 王芳      | 3-245 |     75 |
| 王芳      | 6-166 |     79 |
| 赵铁柱    | 3-105 |     76 |
| 赵铁柱    | 3-245 |     68 |
| 赵铁柱    | 6-166 |     81 |
+-----------+-------+--------+
9 rows in set (0.00 sec)


-- 15.查询所有学生的sno, cname 和 scores 列
select cno, cname from course;
+-------+-----------------+
| cno   | cname           |
+-------+-----------------+
| 3-105 | 计算机导论      |
| 3-245 | 操作系统        |
| 6-166 | 数字电路        |
| 9-888 | 高等数学        |
+-------+-----------------+
4 rows in set (0.00 sec)

select cno, sno, scores from score;
+-------+-----+--------+
| cno   | sno | scores |
+-------+-----+--------+
| 3-105 | 103 |     92 |
| 3-245 | 103 |     86 |
| 6-166 | 103 |     85 |
| 3-105 | 105 |     88 |
| 3-245 | 105 |     75 |
| 6-166 | 105 |     79 |
| 3-105 | 109 |     76 |
| 3-245 | 109 |     68 |
| 6-166 | 109 |     81 |
+-------+-----+--------+
9 rows in set (0.00 sec)
#按照共同字段进行匹配
select cname, sno, scores from score, course 
where score.cno = course.cno;
+-----------------+-----+--------+
| cname           | sno | scores |
+-----------------+-----+--------+
| 计算机导论      | 103 |     92 |
| 计算机导论      | 105 |     88 |
| 计算机导论      | 109 |     76 |
| 操作系统        | 103 |     86 |
| 操作系统        | 105 |     75 |
| 操作系统        | 109 |     68 |
| 数字电路        | 103 |     85 |
| 数字电路        | 105 |     79 |
| 数字电路        | 109 |     81 |
+-----------------+-----+--------+
9 rows in set (0.00 sec)


-- 16.查询所有学生的sname, cname 和 scores 列
-- sname -> student
-- cname -> course
-- scores -> score
select sname, cname, scores from student, course, score where
student.sno = score.sno and course.cno = score.cno;
+-----------+-----------------+--------+
| sname     | cname           | scores |
+-----------+-----------------+--------+
| 王丽      | 计算机导论      |     92 |
| 王丽      | 操作系统        |     86 |
| 王丽      | 数字电路        |     85 |
| 王芳      | 计算机导论      |     88 |
| 王芳      | 操作系统        |     75 |
| 王芳      | 数字电路        |     79 |
| 赵铁柱    | 计算机导论      |     76 |
| 赵铁柱    | 操作系统        |     68 |
| 赵铁柱    | 数字电路        |     81 |
+-----------+-----------------+--------+
9 rows in set (0.00 sec)

-- 或者查询更多信息:
select sname, cname, scores, student.sno as stu_sno, score.sno, 
course.cno as cou_cno, score.cno from 
student, course, score where
student.sno = score.sno and course.cno = score.cno;
+-----------+-----------------+--------+---------+-----+---------+-------+
| sname     | cname           | scores | stu_sno | sno | cou_cno | cno   |
+-----------+-----------------+--------+---------+-----+---------+-------+
| 王丽      | 计算机导论      |     92 | 103     | 103 | 3-105   | 3-105 |
| 王丽      | 操作系统        |     86 | 103     | 103 | 3-245   | 3-245 |
| 王丽      | 数字电路        |     85 | 103     | 103 | 6-166   | 6-166 |
| 王芳      | 计算机导论      |     88 | 105     | 105 | 3-105   | 3-105 |
| 王芳      | 操作系统        |     75 | 105     | 105 | 3-245   | 3-245 |
| 王芳      | 数字电路        |     79 | 105     | 105 | 6-166   | 6-166 |
| 赵铁柱    | 计算机导论      |     76 | 109     | 109 | 3-105   | 3-105 |
| 赵铁柱    | 操作系统        |     68 | 109     | 109 | 3-245   | 3-245 |
| 赵铁柱    | 数字电路        |     81 | 109     | 109 | 6-166   | 6-166 |
+-----------+-----------------+--------+---------+-----+---------+-------+
9 rows in set (0.00 sec)


-- 17.查询"95031"班学生每门课的平均分
-- 先从student表中找到 '95031' 班级
select * from student where class = '95031';
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 102 | 匡明      | 男   | 1975-10-02 00:00:00 | 95031 |
| 105 | 王芳      | 女   | 1975-02-10 00:00:00 | 95031 |
| 106 | 陆君      | 男   | 1974-06-03 00:00:00 | 95031 |
| 107 | 王尼玛    | 男   | 1976-02-20 00:00:00 | 95031 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
| 109 | 赵铁柱    | 男   | 1974-06-03 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
6 rows in set (0.00 sec)
-- 找到该班级中sno列
select * from score where sno in 
(select sno from student where class = '95031');
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 105 | 3-105 |     88 |
| 105 | 3-245 |     75 |
| 105 | 6-166 |     79 |
| 109 | 3-105 |     76 |
| 109 | 3-245 |     68 |
| 109 | 6-166 |     81 |
+-----+-------+--------+
6 rows in set (0.00 sec)

-- 求平均成绩
select cno, avg(scores) from score where sno in 
(select sno from student where class = '95031') 
group by cno;
+-------+-------------+
| cno   | avg(scores) |
+-------+-------------+
| 3-105 |     82.0000 |
| 3-245 |     71.5000 |
| 6-166 |     80.0000 |
+-------+-------------+
3 rows in set (0.01 sec)

select cno, avg(scores) from score where sno in 
(select sno from student where class = '95031')
group by cno;


-- 18.查询选修"3-105"课程的成绩高于"109"号同学"3-105"成绩的所有同学的记录
-- 查询这个同学的成绩
select scores from score where sno = '109' and cno = '3-105';
+--------+
| scores |
+--------+
|     76 |
+--------+
1 row in set (0.00 sec)
-- 课程为3-105且成绩大于这个同学
select * from score where cno = '3-105' and scores > 
(select scores from score where sno = '109' and cno = '3-105');
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 3-105 |     92 |
| 105 | 3-105 |     88 |
+-----+-------+--------+
2 rows in set (0.00 sec)


-- 19.查询成绩高于学号为'109'，课程号为'3-105'的成绩的所有记录
select * from score where scores > 
(select scores from score where sno = '109' and cno = '3-105');
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 3-105 |     92 |
| 103 | 3-245 |     86 |
| 103 | 6-166 |     85 |
| 105 | 3-105 |     88 |
| 105 | 6-166 |     79 |
| 109 | 6-166 |     81 |
+-----+-------+--------+
6 rows in set (0.00 sec)


-- 20.查询和学号为108, 101的同学同年出生的所有学生的sno, sname和sbirthday列
-- 选出学号为108, 101:
select * from student where sno in(108, 101);
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 101 | 曾华      | 男   | 1977-09-01 00:00:00 | 95033 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
2 rows in set (0.00 sec)
-- 查此二人的出生年份:
select year(sbirthday) from student where sno in(108, 101);
+-----------------+
| year(sbirthday) |
+-----------------+
|            1977 |
|            1975 |
+-----------------+
2 rows in set (0.01 sec)
-- 选出所有的和那俩出生年份相同的学生:
select * from student where year(sbirthday) in 
(select year(sbirthday) from student where sno in(108, 101));
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 101 | 曾华      | 男   | 1977-09-01 00:00:00 | 95033 |
| 102 | 匡明      | 男   | 1975-10-02 00:00:00 | 95031 |
| 105 | 王芳      | 女   | 1975-02-10 00:00:00 | 95031 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
4 rows in set (0.01 sec)


-- 21.查询"张旭"教师任课的学生成绩
select * from teacher where tname = '张旭';
-- 张旭教师所任的课
+-----+--------+------+---------------------+--------+-----------------+
| tno | tname  | tsxe | tbirthday           | prof   | depart          |
+-----+--------+------+---------------------+--------+-----------------+
| 856 | 张旭   | 男   | 1969-03-12 00:00:00 | 讲师   | 电子工程系      |
+-----+--------+------+---------------------+--------+-----------------+
1 row in set (0.00 sec)
-- 从course中选出tno = '856'
select * from course where tno = 
(select tno from teacher where tname = '张旭');
+-------+--------------+-----+
| cno   | cname        | tno |
+-------+--------------+-----+
| 6-166 | 数字电路     | 856 |
+-------+--------------+-----+
1 row in set (0.01 sec)
-- 找到6-166学生成绩
select * from score where cno = (select cno from course where tno = 
(select tno from teacher where tname = '张旭'));
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 6-166 |     85 |
| 105 | 6-166 |     79 |
| 109 | 6-166 |     81 |
+-----+-------+--------+
3 rows in set (0.00 sec)


-- 22.查询选修某课程的同学人数多于5人的教师姓名
-- 多加入三条数据:
insert into score values('101','3-105','90');
insert into score values('102','3-105','91');
insert into score values('104','3-105','99');
select * from score group by cno having count(*) > 5;
select * from teacher;
select * from course where cno = 
(select cno from score group by cno having count(*) > 5);
select tno from teacher where tno = 
(select tno from course where cno = 
(select cno from score group by cno having count(*) > 5));
+--------+
| tname  |
+--------+
| 王萍   |
+--------+
1 row in set (0.11 sec)


-- 23.查询95033班和95031班全体学生的记录
-- 增加几条数据:
insert into student values('110','张飞','男','1974-06-03','95038');
select * from student where class in ('95033', '95031');
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 101 | 曾华      | 男   | 1977-09-01 00:00:00 | 95033 |
| 102 | 匡明      | 男   | 1975-10-02 00:00:00 | 95031 |
| 103 | 王丽      | 女   | 1976-01-23 00:00:00 | 95033 |
| 104 | 李军      | 男   | 1976-02-20 00:00:00 | 95033 |
| 105 | 王芳      | 女   | 1975-02-10 00:00:00 | 95031 |
| 106 | 陆君      | 男   | 1974-06-03 00:00:00 | 95031 |
| 107 | 王尼玛    | 男   | 1976-02-20 00:00:00 | 95031 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
| 109 | 赵铁柱    | 男   | 1974-06-03 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
9 rows in set (0.00 sec)


-- 24.查询存在85分以上成绩的课程cno
select cno, scores from score where scores > '85';
+-------+--------+
| cno   | scores |
+-------+--------+
| 3-105 |     90 |
| 3-105 |     91 |
| 3-105 |     92 |
| 3-245 |     86 |
| 3-105 |     99 |
| 3-105 |     88 |
+-------+--------+
6 rows in set (0.00 sec)


-- 25.查询出"计算机系"教师所教课程的成绩表
-- 找到计算机系的老师:
select * from teacher where depart = '计算机系';
+-----+--------+------+---------------------+-----------+--------------+
| tno | tname  | tsxe | tbirthday           | prof      | depart       |
+-----+--------+------+---------------------+-----------+--------------+
| 804 | 李诚   | 男   | 1958-12-02 00:00:00 | 副教授    | 计算机系     |
| 825 | 王萍   | 女   | 1972-05-05 00:00:00 | 助教      | 计算机系     |
+-----+--------+------+---------------------+-----------+--------------+
2 rows in set (0.00 sec)
-- 找到他俩教的课程
select * from course where tno in 
(select tno from teacher where depart = '计算机系');
+-------+-----------------+-----+
| cno   | cname           | tno |
+-------+-----------------+-----+
| 3-245 | 操作系统        | 804 |
| 3-105 | 计算机导论      | 825 |
+-------+-----------------+-----+
2 rows in set (0.01 sec)
-- 找到课程对于成绩表
select * from score where cno in 
(select cno from course where tno in 
(select tno from teacher where depart = '计算机系'));
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 103 | 3-245 |     86 |
| 105 | 3-245 |     75 |
| 109 | 3-245 |     68 |
| 101 | 3-105 |     90 |
| 102 | 3-105 |     91 |
| 103 | 3-105 |     92 |
| 104 | 3-105 |     99 |
| 105 | 3-105 |     88 |
| 109 | 3-105 |     76 |
+-----+-------+--------+
9 rows in set (0.00 sec)


-- 26.查询"计算机系"与"电子工程系"不同职称的教师的tname和prof
-- 电子工程系的教师职称:
select prof from teacher where depart = '电子工程系';
select * from teacher where depart = '计算机系' and prof not in
(select prof from teacher where depart = '电子工程系');
+-----+--------+------+---------------------+-----------+--------------+
| tno | tname  | tsxe | tbirthday           | prof      | depart       |
+-----+--------+------+---------------------+-----------+--------------+
| 804 | 李诚   | 男   | 1958-12-02 00:00:00 | 副教授    | 计算机系     |
+-----+--------+------+---------------------+-----------+--------------+
1 row in set (0.00 sec)
select * from teacher where depart = '电子工程系' and prof not in
(select prof from teacher where depart = '计算机系');
+-----+--------+------+---------------------+--------+-----------------+
| tno | tname  | tsxe | tbirthday           | prof   | depart          |
+-----+--------+------+---------------------+--------+-----------------+
| 856 | 张旭   | 男   | 1969-03-12 00:00:00 | 讲师   | 电子工程系      |
+-----+--------+------+---------------------+--------+-----------------+
1 row in set (0.00 sec)
-- 使用union求并集结果将二者拼起来:
select * from teacher where depart = '计算机系' and prof not in
(select prof from teacher where depart = '电子工程系')
union
select * from teacher where depart = '电子工程系' and prof not in
(select prof from teacher where depart = '计算机系');
+-----+--------+------+---------------------+-----------+-----------------+
| tno | tname  | tsxe | tbirthday           | prof      | depart          |
+-----+--------+------+---------------------+-----------+-----------------+
| 804 | 李诚   | 男   | 1958-12-02 00:00:00 | 副教授    | 计算机系        |
| 856 | 张旭   | 男   | 1969-03-12 00:00:00 | 讲师      | 电子工程系      |
+-----+--------+------+---------------------+-----------+-----------------+
2 rows in set (0.00 sec)


-- 27.查询选修编号为"3-105"课程且成绩至少高于选修编号为"3-245"的
-- 同学的cno,sno和scores, 并按照scores降序排列
-- 至少?大于其中至少一个，any
select * from score where cno = '3-105' and scores >
any(select scores from score where cno = '3-245');
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 101 | 3-105 |     90 |
| 102 | 3-105 |     91 |
| 103 | 3-105 |     92 |
| 104 | 3-105 |     99 |
| 105 | 3-105 |     88 |
| 109 | 3-105 |     76 |
+-----+-------+--------+
6 rows in set (0.00 sec)
-- 排序
select * from score where cno = '3-105' and scores >
any(select scores from score where cno = '3-245')
order by scores desc;
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 104 | 3-105 |     99 |
| 103 | 3-105 |     92 |
| 102 | 3-105 |     91 |
| 101 | 3-105 |     90 |
| 105 | 3-105 |     88 |
| 109 | 3-105 |     76 |
+-----+-------+--------+
6 rows in set (0.00 sec)


-- 28.查询选修编号为"3-105"且成绩高于选修编号为"3-245"课程的
-- 同学的cno, sno和scores
-- 所有 -> all 表示所有关系
select * from score where cno = '3-105' and scores >
all(select scores from score where cno = '3-245');
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 101 | 3-105 |     90 |
| 102 | 3-105 |     91 |
| 103 | 3-105 |     92 |
| 104 | 3-105 |     99 |
| 105 | 3-105 |     88 |
+-----+-------+--------+
5 rows in set (0.00 sec)


-- 29.查询所有教师和同学的name, sex和birthday
select sname, ssex, sbirthday from student union
select tname, tsxe, tbirthday from teacher;
+-----------+------+---------------------+
| sname     | ssex | sbirthday           |
+-----------+------+---------------------+
| 曾华      | 男   | 1977-09-01 00:00:00 |
| 匡明      | 男   | 1975-10-02 00:00:00 |
| 王丽      | 女   | 1976-01-23 00:00:00 |
| 李军      | 男   | 1976-02-20 00:00:00 |
| 王芳      | 女   | 1975-02-10 00:00:00 |
| 陆君      | 男   | 1974-06-03 00:00:00 |
| 王尼玛    | 男   | 1976-02-20 00:00:00 |
| 张全蛋    | 男   | 1975-02-10 00:00:00 |
| 赵铁柱    | 男   | 1974-06-03 00:00:00 |
| 张飞      | 男   | 1974-06-03 00:00:00 |
| 李诚      | 男   | 1958-12-02 00:00:00 |
| 王萍      | 女   | 1972-05-05 00:00:00 |
| 刘冰      | 女   | 1977-08-14 00:00:00 |
| 张旭      | 男   | 1969-03-12 00:00:00 |
+-----------+------+---------------------+
14 rows in set (0.00 sec)
-- 用别名
select sname as name, ssex as sex, sbirthday as birthday from student union
select tname, tsxe, tbirthday from teacher;
-- 第二个不需要取别名，会遵从第一行的别名
+-----------+-----+---------------------+
| name      | sex | birthday            |
+-----------+-----+---------------------+
| 曾华      | 男  | 1977-09-01 00:00:00 |
| 匡明      | 男  | 1975-10-02 00:00:00 |
| 王丽      | 女  | 1976-01-23 00:00:00 |
| 李军      | 男  | 1976-02-20 00:00:00 |
| 王芳      | 女  | 1975-02-10 00:00:00 |
| 陆君      | 男  | 1974-06-03 00:00:00 |
| 王尼玛    | 男  | 1976-02-20 00:00:00 |
| 张全蛋    | 男  | 1975-02-10 00:00:00 |
| 赵铁柱    | 男  | 1974-06-03 00:00:00 |
| 张飞      | 男  | 1974-06-03 00:00:00 |
| 李诚      | 男  | 1958-12-02 00:00:00 |
| 王萍      | 女  | 1972-05-05 00:00:00 |
| 刘冰      | 女  | 1977-08-14 00:00:00 |
| 张旭      | 男  | 1969-03-12 00:00:00 |
+-----------+-----+---------------------+
14 rows in set (0.00 sec)


-- 30.查询所有"女"教师和"女"同学的name, sex和birthday
select tname as name, tsxe as sex, tbirthday as birthday
from teacher where tsxe = '女'
union select sname, ssex, sbirthday from student where ssex = '女';
+--------+-----+---------------------+
| name   | sex | birthday            |
+--------+-----+---------------------+
| 王萍   | 女  | 1972-05-05 00:00:00 |
| 刘冰   | 女  | 1977-08-14 00:00:00 |
| 王丽   | 女  | 1976-01-23 00:00:00 |
| 王芳   | 女  | 1975-02-10 00:00:00 |
+--------+-----+---------------------+
4 rows in set (0.00 sec)


--31.查询成绩比该课程平均成绩低的同学的成绩表
-- 查询每门课的平均成绩:
select cno, avg(scores) from score group by cno;
+-------+-------------+
| cno   | avg(scores) |
+-------+-------------+
| 3-105 |     89.3333 |
| 3-245 |     76.3333 |
| 6-166 |     81.6667 |
+-------+-------------+
3 rows in set (0.00 sec)
select * from score × 2

a                           b
+-----+-------+--------+	+-----+-------+--------+
| sno | cno   | scores |	| sno | cno   | scores |
+-----+-------+--------+	+-----+-------+--------+
| 101 | 3-105 |     90 |	| 101 | 3-105 |     90 |
| 102 | 3-105 |     91 |	| 102 | 3-105 |     91 |
| 103 | 3-105 |     92 |	| 103 | 3-105 |     92 |
| 103 | 3-245 |     86 |	| 103 | 3-245 |     86 |
| 103 | 6-166 |     85 |	| 103 | 6-166 |     85 |
| 104 | 3-105 |     99 |	| 104 | 3-105 |     99 |
| 105 | 3-105 |     88 |	| 105 | 3-105 |     88 |
| 105 | 3-245 |     75 |	| 105 | 3-245 |     75 |
| 105 | 6-166 |     79 |	| 105 | 6-166 |     79 |
| 109 | 3-105 |     76 |	| 109 | 3-105 |     76 |
| 109 | 3-245 |     68 |	| 109 | 3-245 |     68 |
| 109 | 6-166 |     81 |	| 109 | 6-166 |     81 |
+-----+-------+--------+	+-----+-------+--------+
12 rows in set (0.00 sec)	12 rows in set (0.00 sec)

select * from score a where scores < 
(select avg(scores) from score b where a.cno = b.cno);
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 105 | 3-105 |     88 |
| 105 | 3-245 |     75 |
| 105 | 6-166 |     79 |
| 109 | 3-105 |     76 |
| 109 | 3-245 |     68 |
| 109 | 6-166 |     81 |
+-----+-------+--------+
6 rows in set (0.00 sec)


-- 32.查询所有任课教师的tname和depart
select * from teacher;
+-----+--------+------+---------------------+-----------+-----------------+
| tno | tname  | tsxe | tbirthday           | prof      | depart          |
+-----+--------+------+---------------------+-----------+-----------------+
| 804 | 李诚   | 男   | 1958-12-02 00:00:00 | 副教授    | 计算机系        |
| 825 | 王萍   | 女   | 1972-05-05 00:00:00 | 助教      | 计算机系        |
| 831 | 刘冰   | 女   | 1977-08-14 00:00:00 | 助教      | 电子工程系      |
| 856 | 张旭   | 男   | 1969-03-12 00:00:00 | 讲师      | 电子工程系      |
+-----+--------+------+---------------------+-----------+-----------------+
4 rows in set (0.00 sec)
-- 在课程表中安排了课程
select * from course;
+-------+-----------------+-----+
| cno   | cname           | tno |
+-------+-----------------+-----+
| 3-105 | 计算机导论      | 825 |
| 3-245 | 操作系统        | 804 |
| 6-166 | 数字电路        | 856 |
| 9-888 | 高等数学        | 831 |
+-------+-----------------+-----+
4 rows in set (0.00 sec)
select tname, depart from teacher where tno in (select tno from course);
+--------+-----------------+
| tname  | depart          |
+--------+-----------------+
| 李诚   | 计算机系        |
| 王萍   | 计算机系        |
| 刘冰   | 电子工程系      |
| 张旭   | 电子工程系      |
+--------+-----------------+
4 rows in set (0.00 sec)


-- 33.查询至少有2名男生的班号
select class, count(*) from student where ssex = '男' group by class
having count(*) > 1;
+-------+
| class |
+-------+
| 95033 |
| 95031 |
+-------+
2 rows in set (0.01 sec)


-- 34.查询student表中不姓"王"的同学记录
 -- 用not like模糊查询
select * from student where sname not like '王%';


-- 35.查询student表中每个学生的姓名和年龄
select year(sbirthday) from student;
select sname, year(now()) - year(sbirthday) as '年龄' from student;
+-----------+--------+
| sname     | 年龄   |
+-----------+--------+
| 曾华      |     43 |
| 匡明      |     45 |
| 王丽      |     44 |
| 李军      |     44 |
| 王芳      |     45 |
| 陆君      |     46 |
| 王尼玛    |     44 |
| 张全蛋    |     45 |
| 赵铁柱    |     46 |
| 张飞      |     46 |
+-----------+--------+
10 rows in set (0.01 sec)


-- 36.查询student表中最大和最小的sbirthday日期值
-- max min
select max(sbirthday) as '最大', min(sbirthday) as '最小' from student;
+---------------------+---------------------+
| 最大                | 最小                |
+---------------------+---------------------+
| 1977-09-01 00:00:00 | 1974-06-03 00:00:00 |
+---------------------+---------------------+
1 row in set (0.00 sec)


-- 37.以班号和年龄从大到小的顺序查询student表中的全部记录
select * from student order by class desc, sbirthday;
+-----+-----------+------+---------------------+-------+
| sno | sname     | ssex | sbirthday           | class |
+-----+-----------+------+---------------------+-------+
| 110 | 张飞      | 男   | 1974-06-03 00:00:00 | 95038 |
| 103 | 王丽      | 女   | 1976-01-23 00:00:00 | 95033 |
| 104 | 李军      | 男   | 1976-02-20 00:00:00 | 95033 |
| 101 | 曾华      | 男   | 1977-09-01 00:00:00 | 95033 |
| 106 | 陆君      | 男   | 1974-06-03 00:00:00 | 95031 |
| 109 | 赵铁柱    | 男   | 1974-06-03 00:00:00 | 95031 |
| 105 | 王芳      | 女   | 1975-02-10 00:00:00 | 95031 |
| 108 | 张全蛋    | 男   | 1975-02-10 00:00:00 | 95031 |
| 102 | 匡明      | 男   | 1975-10-02 00:00:00 | 95031 |
| 107 | 王尼玛    | 男   | 1976-02-20 00:00:00 | 95031 |
+-----+-----------+------+---------------------+-------+
10 rows in set (0.00 sec)


-- 38.查询"男"教师及其所上的课程
select * from teacher where tsxe = '男';
+-----+--------+------+---------------------+-----------+-----------------+
| tno | tname  | tsxe | tbirthday           | prof      | depart          |
+-----+--------+------+---------------------+-----------+-----------------+
| 804 | 李诚   | 男   | 1958-12-02 00:00:00 | 副教授    | 计算机系        |
| 856 | 张旭   | 男   | 1969-03-12 00:00:00 | 讲师      | 电子工程系      |
+-----+--------+------+---------------------+-----------+-----------------+
2 rows in set (0.00 sec)
select * from course where tno in 
(select tno from teacher where tsxe = '男');
+-------+--------------+-----+
| cno   | cname        | tno |
+-------+--------------+-----+
| 3-245 | 操作系统     | 804 |
| 6-166 | 数字电路     | 856 |
+-------+--------------+-----+
2 rows in set (0.00 sec)


--39. 查询最高分同学的sno, cno和scores列
select max(scores) from score;
+-------------+
| max(Scores) |
+-------------+
|          99 |
+-------------+
1 row in set (0.00 sec)
select * from score where scores =
(select max(scores) from score);
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 104 | 3-105 |     99 |
+-----+-------+--------+
1 row in set (0.00 sec)


-- 40.查询和"李军"同性别的所有同学的sname
select sname from student where ssex = 
(select ssex from student where sname = '李军');
+-----------+
| sname     |
+-----------+
| 曾华      |
| 匡明      |
| 李军      |
| 陆君      |
| 王尼玛    |
| 张全蛋    |
| 赵铁柱    |
| 张飞      |
+-----------+
8 rows in set (0.00 sec)


-- 41.查询和"李军"同性别并同班的同学的sname
select sname from student where ssex = 
(select ssex from student where sname = '李军')
and class = (select class from student where sname = '李军');


-- 42.查询所有选修"计算机导论"课程的"男"同学的成绩表

select * from score where sno in
(select sno from student where ssex = '男') and
cno in (select cno from course where cname = '计算机导论');
+-----+-------+--------+
| sno | cno   | scores |
+-----+-------+--------+
| 101 | 3-105 |     90 |
| 102 | 3-105 |     91 |
| 104 | 3-105 |     99 |
| 109 | 3-105 |     76 |
+-----+-------+--------+
4 rows in set (0.00 sec)


-- 43.假设使用如下命令建立了一个grade表:
create table grade(
	low int(3),
	upp int(3),
	grade char(1)
);
insert into grade values(90,100,'A');
insert into grade values(80,89,'B');
insert into grade values(70,79,'C');
insert into grade values(60,69,'D');
insert into grade values(0,59,'E');
-- 查询所有同学的sno, cno和grade列
+-----+-------+-------+
| sno | cno   | grade |
+-----+-------+-------+
| 101 | 3-105 | A     |
| 102 | 3-105 | A     |
| 103 | 3-105 | A     |
| 103 | 3-245 | B     |
| 103 | 6-166 | B     |
| 104 | 3-105 | A     |
| 105 | 3-105 | B     |
| 105 | 3-245 | C     |
| 105 | 6-166 | C     |
| 109 | 3-105 | C     |
| 109 | 3-245 | D     |
| 109 | 6-166 | B     |
+-----+-------+-------+
12 rows in set (0.00 sec)





